<!DOCTYPE html>
<html>
<head>
    <title>Multiplication Facts</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../../styles.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="icon" href="../../favicon.svg" type="image/x-icon">
</head>

<body>
  <pre>
    <h1>Multiplication Facts <span class="correct">Practice</span></h1>
    <h2>Ready? (y/n) or (1/0)</h2>
  </pre>
  <div id="grid" class="grid"></div>
  <div id="lattice" class="lattice"></div>
  <view></view>
  <cell>
  <div id="shell"><p><span>> </span><span></span><span class="blink">&#x2588;</span></p></div>
  </cell>
  <div id="interlaced"></div>  
  <div id="glare"></div>
</body>
<script>

class Question {
    constructor(i, j, el) {
        this.i = i;
        this.j = j;
        this.el = el;
        this.n_right = 10;
        this.n_wrong = 10;
    }

    getQuestionText () {
      return this.i + ' * ' + this.j + ' = ' 
    }

    checkAnswer (value) {
      let correct = value == this.i * this.j;
      if (correct) {
        this.n_right += 1;
      } else {
        this.n_wrong += 1;
      }

      if ((this.n_right + this.n_wrong) > 32 && this.n_wrong > 0) {
        this.n_wrong -= 1;
      } else {
        this.n_right -= 1;
      }
      this.setColor()
    }

    setColor () {
        let newAlpha = ((this.n_right - this.n_wrong) / (this.n_right + this.n_wrong) - 0.5) * 2;
        if ((this.n_right - this.n_wrong) > 0) {
            let color = rgbToRgbString(147, 209, 182, newAlpha);
        } else if ((this.n_right - this.n_wrong) < 0) {
            let color = rgbToRgbString(212, 112, 112, -newAlpha);
        } else {
            let color = rgbToRgbString(170, 160, 147, 0.0);
        }
        this.el.style.backgroundColor = color;
    }
}

  const minMultiplicand = 0;
  const maxMultiplicand = 12;
  const grid = [];
  const lattice = document.getElementById("lattice");
  const typingSpeed = 25;


  for (let i = 0; i < (maxMultiplicand - minMultiplicand + 1); i++) {
    const row = document.createElement("div");
    const line = [];
    row.classList.add("row");
    for (let j = 0; j < (maxMultiplicand - minMultiplicand + 1); j++) {
      const sq = document.createElement("div");
      sq.classList.add("sq")
      line.push(new Question(minMultiplicand + i, minMultiplicand + j, sq))
//      line.push([10, 10, sq, minMultiplicand + row, minMultiplicand + col])
      row.appendChild(sq);
    }
    grid.push(line)
    lattice.appendChild(row);
  }


  function submit(text) {
    if (text === 'clear' || text === 'cls') {
      const shell = document.getElementById('shell');
    
      while (shell.lastChild && shell.lastChild !== shell.firstElementChild) {
       shell.removeChild(shell.firstChild);
      }
    } else if (text === '0' || text === 'n') {
      window.location.replace('../../index.html');
    }
  };
  
  const shell = document.getElementById('shell');
  function getPrompt() {
    return shell.lastElementChild.firstElementChild.nextElementSibling;
  }
  const cursor = shell.lastElementChild.lastElementChild;



  function input(k) {
    let prompt = getPrompt()
    const allowed = "1234567890"
    if (k === "Backspace") {
      // Remove last character
      let text = prompt.innerText;
      prompt.innerText = text.slice(0, -1);
    } else if (k === "Enter") {
      if (prompt.innerText.length > 0) {
        const newline = document.createElement('p');
        newline.appendChild(document.createElement('span'));
        newline.lastElementChild.innerText = '> ';
        newline.appendChild(document.createElement('span'));
        newline.appendChild(cursor);
        submit(prompt.innerText);
        shell.appendChild(newline);
      }
    } else if (k === 'Escape') {
      window.location.replace('../../index.html'); 
    } else if (k.length === 1 && allowed.indexOf(k) > -1) {
      // Regular printable characters (letters, numbers, symbols)
      prompt.innerText += k;
  };
};

function typeQuestion(text) {
  shell.lastElementChild.firstElementChild.innerText += text.charAt(0);
  if (text.length > 0) {
    setTimeout(typeQuestion, typingSpeed, text.slice(1, text.length));
  } else if (shell.lastElementChild.firstElementChild.innerText.slice(-1) != ' ') {
    shell.lastElementChild.firstElementChild.innerText += ' ';
  }
}

$(document).ready(function () {
  $(document).on('keydown', function (e) { 
    input(e.key);
    e.preventDefault(); 
  });
});

function askQuestion () {
  let i = Math.random() * (maxMultiplicand - minMultiplicand + 1);
  let j = Math.random() * (maxMultiplicand - minMultiplicand + 1);
  let currentProblem = grid[i][j];
  prompt.innerText = currentProblem.getQuestionText();
  submit();
}

/*
const startTime = performance.now();
while ((performance.now() - startTime)/1000 < 30) {
  let i = Math.floor(Math.random() * (maxMultiplicand - minMultiplicand + 1));
  let j = Math.floor(Math.random() * (maxMultiplicand - minMultiplicand + 1));
  let currentProblem = grid[i][j];
  prompt.innerText = currentProblem.getQuestionText();
}
*/
</script>

</html>